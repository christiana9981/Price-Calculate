<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HDH帽子报价系统</title>
    <link href="https://fonts.googleapis.com/css2?family=Microsoft+YaHei:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            font-size: 16px;
            background: linear-gradient(135deg, #e6d4ff, #d8c4ff);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #8a6dcc, #5a2d9e);
        }
        
        h1 {
            font-size: 36px;
            color: #5a2d9e;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            background: linear-gradient(45deg, #5a2d9e, #8a6dcc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: 18px;
            color: #7a5fb5;
            margin-bottom: 15px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.92);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #8a6dcc, #5a2d9e);
        }
        
        .card-title {
            font-size: 24px;
            color: #5a2d9e;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e6d4ff;
            display: flex;
            align-items: center;
        }
        
        .card-title i {
            margin-right: 10px;
            color: #8a6dcc;
            font-size: 22px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-col {
            flex: 1;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #5a2d9e;
        }
        
        select, input, button {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #d8c4ff;
            border-radius: 8px;
            font-family: 'Microsoft YaHei', sans-serif;
            font-size: 16px;
            background: #f9f6ff;
            transition: all 0.3s;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #8a6dcc;
            box-shadow: 0 0 0 3px rgba(138, 109, 204, 0.2);
        }
        
        button {
            background: linear-gradient(135deg, #8a6dcc, #5a2d9e);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            padding: 14px;
            margin-top: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(90, 45, 158, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        button::after {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }
        
        button:hover {
            background: linear-gradient(135deg, #5a2d9e, #8a6dcc);
            box-shadow: 0 6px 15px rgba(90, 45, 158, 0.3);
            transform: translateY(-2px);
        }
        
        button:hover::after {
            left: 100%;
        }
        
        button.secondary {
            background: linear-gradient(135deg, #6d8bcc, #2d5e9e);
            max-width: 250px;
            margin-left: auto;
        }
        
        button.danger {
            background: linear-gradient(135deg, #cc6d6d, #9e2d2d);
            max-width: 120px;
        }
        
        button.select-btn {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            max-width: 180px;
            padding: 10px 15px;
            font-size: 14px;
        }
        
        button.info {
            background: linear-gradient(135deg, #2196F3, #0d47a1);
            max-width: 250px;
        }
        
        .table-responsive {
            overflow-x: auto;
            margin-top: 15px;
            border-radius: 10px;
            border: 1px solid #e6d4ff;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0;
        }
        
        th, td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid #e6d4ff;
        }
        
        th {
            background: #f0e9ff;
            color: #5a2d9e;
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background: #f9f6ff;
        }
        
        .section-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .section-col {
            flex: 1;
        }
        
        .result-box {
            background: linear-gradient(135deg, #8a6dcc, #5a2d9e);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-top: 30px;
            box-shadow: 0 12px 30px rgba(90, 45, 158, 0.35);
            position: relative;
            overflow: hidden;
        }
        
        .result-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect fill="none" width="100" height="100"/><path d="M0,0 L100,100 M100,0 L0,100" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></svg>');
            opacity: 0.3;
        }
        
        .result-title {
            font-size: 26px;
            margin-bottom: 20px;
            font-weight: bold;
            position: relative;
        }
        
        .total-price {
            font-size: 48px;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            position: relative;
        }
        
        .summary {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
            position: relative;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 17px;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .fabrics-section {
            position: relative;
        }
        
        .fabrics-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .fabrics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .selection-controls {
            display: flex;
            gap: 10px;
        }
        
        .usage-summary {
            background: #f0e9ff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            border: 1px solid #d8c4ff;
        }
        
        .usage-summary h3 {
            color: #5a2d9e;
            margin-bottom: 10px;
        }
        
        .usage-value {
            font-size: 24px;
            font-weight: bold;
            color: #8a6dcc;
        }
        
        .process-item {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #e6d4ff;
            border-radius: 10px;
            background: #f9f6ff;
            position: relative;
        }
        
        .remove-process {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            width: 30px;
            height: 30px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .remove-process:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        .process-details-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .process-detail-col {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .detail-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .detail-label {
            min-width: 120px;
            font-weight: bold;
            color: #5a2d9e;
        }
        
        .detail-value {
            flex: 1;
        }
        
        .price-display {
            font-weight: bold;
            color: #5a2d9e;
            padding: 8px 12px;
            background: #f0e9ff;
            border-radius: 6px;
            min-width: 100px;
        }
        
        .process-result {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #e6d4ff;
            font-weight: bold;
            font-size: 18px;
            color: #5a2d9e;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .process-total-label {
            font-weight: bold;
        }
        
        .process-total-price {
            font-size: 20px;
            color: #8a6dcc;
        }
        
        .custom-input {
            border: 1px solid #d8c4ff;
            border-radius: 6px;
            padding: 8px 12px;
            font-family: 'Microsoft YaHei', sans-serif;
            font-size: 15px;
            width: 100%;
        }
        
        .fabrics-total {
            font-weight: bold;
            font-size: 18px;
            color: #5a2d9e;
            text-align: right;
            padding: 10px 15px;
            background: #f0e9ff;
            border-radius: 0 0 10px 10px;
        }
        
        @media (max-width: 992px) {
            .process-details-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .fabrics-buttons {
                flex-direction: column;
            }
            
            .fabrics-buttons button {
                max-width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            .section-row {
                flex-direction: column;
            }
            
            .process-details-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 28px;
            }
            
            .total-price {
                font-size: 36px;
            }
            
            .fabrics-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .selection-controls {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>HDH 五片帽 / 六片帽报价系统</h1>
            <p class="subtitle">专业、精准、高效的帽子成本计算工具</p>
        </header>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-hat-cowboy"></i> 1. 帽型选择</h2>
            <div class="form-group">
                <label for="hat-type">选择帽型：</label>
                <select id="hat-type">
                    <option value="five-piece">五片帽</option>
                    <option value="six-piece">六片帽</option>
                </select>
            </div>
        </div>
        
        <div class="card fabrics-section">
            <h2 class="card-title"><i class="fas fa-cut"></i> 2. 面料报价</h2>
            
            <div class="fabrics-header">
                <div>
                    <h3>面料选择控制</h3>
                    <p>请选择需要计算的面料部位：</p>
                </div>
                <div class="selection-controls">
                    <button id="select-all" class="select-btn"><i class="fas fa-check-square"></i> 全选</button>
                    <button id="deselect-all" class="select-btn"><i class="fas fa-times-circle"></i> 取消全选</button>
                </div>
            </div>
            
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 40px;">
                                <input type="checkbox" id="header-checkbox">
                            </th>
                            <th>报价类型</th>
                            <th>帽子部位</th>
                            <th>默认用量(米/顶)</th>
                            <th>自定义用量(米/顶)</th>
                            <th>面料选择</th>
                            <th>单价(美元)</th>
                            <th>部位总价(美元)</th>
                        </tr>
                    </thead>
                    <tbody id="fabrics-table">
                        <!-- 面料行将由JavaScript动态生成 -->
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="7" style="text-align: right; font-weight: bold;">面料总价:</td>
                            <td id="fabrics-total-price">$0.00</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            
            <div class="usage-summary">
                <h3><i class="fas fa-ruler"></i> 选中部位总面料用量</h3>
                <div class="usage-value" id="total-usage">0.00 米</div>
            </div>
            
            <div class="fabrics-buttons">
                <button id="calculate-total-usage" class="info"><i class="fas fa-calculator"></i> 计算总面料用量</button>
                <button id="calculate-fabrics" class="secondary"><i class="fas fa-dollar-sign"></i> 计算面料价格</button>
                <button id="custom-fabrics" class="secondary"><i class="fas fa-edit"></i> 自定义面料总价</button>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-eye"></i> 3. 锁眼报价</h2>
            <div class="form-group">
                <label for="buttonhole">锁眼数量：</label>
                <select id="buttonhole">
                    <option value="0">没有锁眼 ($0.00)</option>
                    <option value="4">4个锁眼 ($0.04)</option>
                    <option value="6">6个锁眼 ($0.06)</option>
                </select>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-tools"></i> 4. 工艺计价</h2>
            <div id="process-container">
                <!-- 工艺部分将由JavaScript动态生成 -->
            </div>
            <button id="add-process"><i class="fas fa-plus-circle"></i> 添加工艺</button>
            <button id="calculate-process" class="secondary"><i class="fas fa-calculator"></i> 计算工艺总价</button>
            <div style="margin-top: 20px; font-weight: bold; text-align: right;">
                工艺总价: <span id="process-total-price">$0.00</span>
            </div>
        </div>
        
        <div class="section-row">
            <div class="section-col">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-th"></i> 5. 辅料报价</h2>
                    <div class="form-group">
                        <label for="accessories">辅料类型：</label>
                        <select id="accessories">
                            <option value="0.49">一般 ($0.49)</option>
                            <option value="custom">自定义</option>
                        </select>
                    </div>
                    <div class="form-group" id="custom-accessories" style="display: none;">
                        <label for="accessories-custom">自定义价格(美元)：</label>
                        <input type="number" id="accessories-custom" step="0.01" min="0" value="0">
                    </div>
                </div>
            </div>
            
            <div class="section-col">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-tag"></i> 6. 吊牌和标报价</h2>
                    <div class="form-group">
                        <label for="tags">吊牌类型：</label>
                        <select id="tags">
                            <option value="0.79">一般 ($0.79)</option>
                            <option value="custom">自定义</option>
                        </select>
                    </div>
                    <div class="form-group" id="custom-tags" style="display: none;">
                        <label for="tags-custom">自定义价格(美元)：</label>
                        <input type="number" id="tags-custom" step="0.01" min="0" value="0">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-user-clock"></i> 7. 工时报价</h2>
            <div class="form-group">
                <label for="labor">工时等级：</label>
                <select id="labor">
                    <option value="1.3">A级 ($1.3)</option>
                    <option value="1.5">B级 ($1.5)</option>
                    <option value="1.8">C级 ($1.8)</option>
                    <option value="custom">自定义</option>
                </select>
            </div>
            <div class="form-group" id="custom-labor" style="display: none;">
                <label for="labor-custom">自定义价格(美元)：</label>
                <input type="number" id="labor-custom" step="0.01" min="0" value="0">
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title"><i class="fas fa-receipt"></i> 8. 其他杂费</h2>
            <div class="form-group">
                <div class="summary-item">
                    <span>测试费用：</span>
                    <span>$0.30</span>
                </div>
                <div class="summary-item">
                    <span>人头费：</span>
                    <span>工时 × 0.15</span>
                </div>
                <div class="summary-item">
                    <span>利润：</span>
                    <span>总价 × 0.20</span>
                </div>
                <div class="summary-item">
                    <span>佣金：</span>
                    <span>$0.40</span>
                </div>
            </div>
        </div>
        
        <div class="result-box">
            <div class="result-title">每顶帽子总价</div>
            <div class="total-price" id="total-price">$0.00</div>
            <button id="calculate-total"><i class="fas fa-calculator"></i> 计算总价</button>
            
            <div class="summary">
                <div class="summary-item">
                    <span>面料成本：</span>
                    <span id="fabrics-cost">$0.00</span>
                </div>
                <div class="summary-item">
                    <span>锁眼成本：</span>
                    <span id="buttonhole-cost">$0.00</span>
                </div>
                <div class="summary-item">
                    <span>工艺成本：</span>
                    <span id="process-cost">$0.00</span>
                </div>
                <div class="summary-item">
                    <span>辅料成本：</span>
                    <span id="accessories-cost">$0.00</span>
                </div>
                <div class="summary-item">
                    <span>吊牌成本：</span>
                    <span id="tags-cost">$0.00</span>
                </div>
                <div class="summary-item">
                    <span>工时成本：</span>
                    <span id="labor-cost">$0.00</span>
                </div>
                <div class="summary-item">
                    <span>其他杂费：</span>
                    <span id="misc-cost">$0.00</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 面料数据
        const fabricPrices = {
            '22F': 2.78,
            '81U': 2.38,
            '3M': 1.38,
            '6K': 1.75,
            '3X': 3.27,
            '2X': 3.92,
            '2E': 1.89,
            '2D': 4.34,
            '182N': 5.62,
            '23L': 2.26,
            '16X': 4.36,
            '68R': 3.57,
            '45L': 1.40,
            'LGYJ1308': 4.91,
            '11W': 4.6,
            '41L': 1.95,
            '84C': 4.48,
            '22E': 3.45,
            '25XR': 4.81,
            '5H': 4.38,
            '16J': 3.1,
            '2Z': 2.42,
            '226Y': 1.78,
            '3X迷彩水印': 4.84,
            '98O': 4.4,
            '88T': 7.14,
            '81P': 1.50,
            '2P': 1.0,
            '303Z': 3.12,
            '308R': 4.09,
            '308T': 2.86,
            'BDJ': 0.48,
            '自定义': 0
        };
        
        // 五片帽部位用量
        const fivePieceUsage = {
            '前片': 0.03,
            '上眉': 0.02,
            '下眉': 0.02,
            '普通汗带': 0.06,
            '弹力汗带': 0.79,
            '寸条滚条': 0.01,
            '2号片': 0.03,
            '3号片': 0.03,
            '前片衬': 0.03,
            '三明治': 0.01
        };
        
        // 六片帽部位用量
        const sixPieceUsage = {
            '1号片': 0.02,
            '上眉': 0.02,
            '下眉': 0.02,
            '普通汗带': 0.06,
            '弹力汗带': 0.79,
            '寸条滚条': 0.01,
            '2号片': 0.03,
            '3号片': 0.03,
            '前片衬': 0.03,
            '三明治': 0.01
        };
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化面料表格
            initializeFabricsTable();
            
            // 添加工艺事件监听
            document.getElementById('add-process').addEventListener('click', addNewProcess);
            
            // 计算面料价格
            document.getElementById('calculate-fabrics').addEventListener('click', calculateFabricsCost);
            
            // 自定义面料价格
            document.getElementById('custom-fabrics').addEventListener('click', function() {
                const currentTotal = parseFloat(document.getElementById('fabrics-total-price').textContent.replace('$', ''));
                const customPrice = prompt("请输入自定义面料总价（美元）：", currentTotal.toFixed(2));
                if (customPrice !== null) {
                    const price = parseFloat(customPrice) || 0;
                    document.getElementById('fabrics-total-price').textContent = '$' + price.toFixed(2);
                    document.getElementById('fabrics-cost').textContent = '$' + price.toFixed(2);
                }
            });
            
            // 计算工艺总价
            document.getElementById('calculate-process').addEventListener('click', calculateProcessCost);
            
            // 计算总价
            document.getElementById('calculate-total').addEventListener('click', calculateTotalCost);
            
            // 帽型变化事件
            document.getElementById('hat-type').addEventListener('change', updateFabricsTable);
            
            // 辅料自定义显示
            document.getElementById('accessories').addEventListener('change', function() {
                document.getElementById('custom-accessories').style.display = 
                    this.value === 'custom' ? 'block' : 'none';
            });
            
            // 吊牌自定义显示
            document.getElementById('tags').addEventListener('change', function() {
                document.getElementById('custom-tags').style.display = 
                    this.value === 'custom' ? 'block' : 'none';
            });
            
            // 工时自定义显示
            document.getElementById('labor').addEventListener('change', function() {
                document.getElementById('custom-labor').style.display = 
                    this.value === 'custom' ? 'block' : 'none';
            });
            
            // 全选按钮
            document.getElementById('select-all').addEventListener('click', selectAllFabrics);
            
            // 取消全选按钮
            document.getElementById('deselect-all').addEventListener('click', deselectAllFabrics);
            
            // 表头复选框
            document.getElementById('header-checkbox').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('.fabric-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
            });
            
            // 计算总面料用量按钮
            document.getElementById('calculate-total-usage').addEventListener('click', calculateTotalUsage);
            
            // 添加第一个工艺
            addNewProcess();
        });
        
        // 全选面料
        function selectAllFabrics() {
            const checkboxes = document.querySelectorAll('.fabric-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            document.getElementById('header-checkbox').checked = true;
        }
        
        // 取消全选面料
        function deselectAllFabrics() {
            const checkboxes = document.querySelectorAll('.fabric-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('header-checkbox').checked = false;
        }
        
        // 计算总面料用量
        function calculateTotalUsage() {
            let totalUsage = 0;
            const rows = document.querySelectorAll('#fabrics-table tr');
            
            rows.forEach(row => {
                const checkbox = row.querySelector('.fabric-checkbox');
                if (checkbox.checked) {
                    // 获取自定义用量，如果没有则使用默认用量
                    const customUsageInput = row.querySelector('.custom-usage');
                    const usage = customUsageInput.value ? 
                                 parseFloat(customUsageInput.value) : 
                                 parseFloat(row.cells[3].textContent);
                    
                    totalUsage += usage;
                }
            });
            
            document.getElementById('total-usage').textContent = totalUsage.toFixed(3) + " 米";
            return totalUsage;
        }
        
        // 初始化面料表格
        function initializeFabricsTable() {
            const tableBody = document.getElementById('fabrics-table');
            tableBody.innerHTML = '';
            
            const hatType = document.getElementById('hat-type').value;
            const usageData = hatType === 'five-piece' ? fivePieceUsage : sixPieceUsage;
            
            for (const [part, defaultUsage] of Object.entries(usageData)) {
                const row = document.createElement('tr');
                
                // 复选框
                const checkboxCell = document.createElement('td');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.classList.add('fabric-checkbox');
                checkbox.checked = true;
                checkboxCell.appendChild(checkbox);
                
                // 报价类型
                const quoteTypeCell = document.createElement('td');
                const quoteTypeSelect = document.createElement('select');
                quoteTypeSelect.classList.add('quote-type');
                quoteTypeSelect.innerHTML = `
                    <option value="FOB">FOB</option>
                    <option value="CIF">CIF</option>
                `;
                quoteTypeCell.appendChild(quoteTypeSelect);
                
                // 帽子部位
                const partCell = document.createElement('td');
                partCell.textContent = part;
                
                // 默认用量
                const defaultUsageCell = document.createElement('td');
                defaultUsageCell.textContent = defaultUsage.toFixed(3);
                
                // 自定义用量
                const customUsageCell = document.createElement('td');
                const customUsageInput = document.createElement('input');
                customUsageInput.type = 'number';
                customUsageInput.step = '0.001';
                customUsageInput.min = '0';
                customUsageInput.value = defaultUsage.toFixed(3);
                customUsageInput.classList.add('custom-usage');
                customUsageCell.appendChild(customUsageInput);
                
                // 面料选择
                const fabricCell = document.createElement('td');
                const fabricSelect = document.createElement('select');
                fabricSelect.classList.add('fabric-select');
                
                // 添加面料选项
                for (const [fabricName] of Object.entries(fabricPrices)) {
                    const option = document.createElement('option');
                    option.value = fabricName;
                    option.textContent = fabricName;
                    fabricSelect.appendChild(option);
                }
                
                fabricCell.appendChild(fabricSelect);
                
                // 单价
                const priceCell = document.createElement('td');
                priceCell.classList.add('fabric-price');
                priceCell.textContent = '$0.00';
                
                // 部位总价
                const totalCell = document.createElement('td');
                totalCell.classList.add('part-total');
                totalCell.textContent = '$0.00';
                
                row.appendChild(checkboxCell);
                row.appendChild(quoteTypeCell);
                row.appendChild(partCell);
                row.appendChild(defaultUsageCell);
                row.appendChild(customUsageCell);
                row.appendChild(fabricCell);
                row.appendChild(priceCell);
                row.appendChild(totalCell);
                
                tableBody.appendChild(row);
            }
            
            // 添加事件监听
            addFabricsTableEventListeners();
        }
        
        // 更新面料表格（帽型变化时）
        function updateFabricsTable() {
            initializeFabricsTable();
        }
        
        // 添加面料表格事件监听
        function addFabricsTableEventListeners() {
            const rows = document.querySelectorAll('#fabrics-table tr');
            rows.forEach(row => {
                const quoteTypeSelect = row.querySelector('.quote-type');
                const fabricSelect = row.querySelector('.fabric-select');
                const customUsageInput = row.querySelector('.custom-usage');
                const priceCell = row.querySelector('.fabric-price');
                const totalCell = row.querySelector('.part-total');
                
                // 更新价格
                const updatePrice = () => {
                    const fabric = fabricSelect.value;
                    const quoteType = quoteTypeSelect.value;
                    const usage = parseFloat(customUsageInput.value) || parseFloat(row.cells[3].textContent);
                    
                    let price = fabricPrices[fabric] || 0;
                    if (quoteType === 'CIF') {
                        price *= 1.1;
                    }
                    
                    priceCell.textContent = '$' + price.toFixed(2);
                    totalCell.textContent = '$' + (price * usage).toFixed(2);
                };
                
                quoteTypeSelect.addEventListener('change', updatePrice);
                fabricSelect.addEventListener('change', updatePrice);
                customUsageInput.addEventListener('input', updatePrice);
                
                // 初始化价格
                updatePrice();
            });
        }
        
        // 计算面料总价（只计算选中的行）
        function calculateFabricsCost() {
            let total = 0;
            const rows = document.querySelectorAll('#fabrics-table tr');
            
            rows.forEach(row => {
                const checkbox = row.querySelector('.fabric-checkbox');
                if (checkbox.checked) {
                    const totalText = row.querySelector('.part-total').textContent;
                    const value = parseFloat(totalText.replace('$', '')) || 0;
                    total += value;
                }
            });
            
            document.getElementById('fabrics-total-price').textContent = '$' + total.toFixed(2);
            document.getElementById('fabrics-cost').textContent = '$' + total.toFixed(2);
            return total;
        }
        
        // 添加工艺
        function addNewProcess() {
            const container = document.getElementById('process-container');
            const processIndex = container.children.length;
            
            const processDiv = document.createElement('div');
            processDiv.classList.add('process-item');
            processDiv.dataset.index = processIndex;
            
            processDiv.innerHTML = `
                <button class="remove-process">×</button>
                <div class="form-group">
                    <label>工艺类型：</label>
                    <select class="process-type">
                        <option value="">请选择工艺类型</option>
                        <option value="embroidery">绣花</option>
                        <option value="washing">水洗</option>
                        <option value="printing">印刷</option>
                        <option value="laser">镭射切割</option>
                        <option value="other">其他</option>
                    </select>
                </div>
                
                <div class="process-details" style="display: none;">
                    <!-- 动态内容 -->
                </div>
                
                <div class="process-result" style="display: none;">
                    <span class="process-total-label">工艺价格:</span>
                    <span class="process-total-price">$0.00</span>
                </div>
            `;
            
            container.appendChild(processDiv);
            
            // 添加工艺类型变化事件
            const processTypeSelect = processDiv.querySelector('.process-type');
            processTypeSelect.addEventListener('change', function() {
                updateProcessDetails(processDiv, this.value);
            });
            
            // 添加移除按钮事件
            const removeBtn = processDiv.querySelector('.remove-process');
            removeBtn.addEventListener('click', function() {
                processDiv.remove();
                calculateProcessCost();
            });
        }
        
        // 更新工艺详情
        function updateProcessDetails(processDiv, processType) {
            const detailsDiv = processDiv.querySelector('.process-details');
            const resultDiv = processDiv.querySelector('.process-result');
            detailsDiv.style.display = 'block';
            resultDiv.style.display = 'flex';
            
            switch(processType) {
                case 'embroidery':
                    detailsDiv.innerHTML = `
                        <div class="process-details-grid">
                            <div class="process-detail-col">
                                <div class="detail-row">
                                    <div class="detail-label">绣花类型：</div>
                                    <select class="embroidery-type">
                                        <option value="flat">平绣</option>
                                        <option value="3d">3D绣</option>
                                        <option value="custom">自定义</option>
                                    </select>
                                </div>
                                
                                <div class="detail-row">
                                    <div class="detail-label">针数：</div>
                                    <input type="number" class="stitches" min="0" value="1000">
                                </div>
                            </div>
                            
                            <div class="process-detail-col">
                                <div class="detail-row">
                                    <div class="detail-label">平绣价格：</div>
                                    <div class="price-display">$0.06/1000针</div>
                                </div>
                                <div class="detail-row">
                                    <div class="detail-label">3D绣价格：</div>
                                    <div class="price-display">$0.075/1000针</div>
                                </div>
                            </div>
                            
                            <div class="process-detail-col">
                                <div class="detail-row">
                                    <div class="detail-label">自定义报价：</div>
                                    <input type="number" class="custom-embroidery-price" step="0.01" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <button class="calculate-process-price">计算绣花价格</button>
                    `;
                    
                    // 添加计算绣花价格事件
                    const calculateBtn = detailsDiv.querySelector('.calculate-process-price');
                    calculateBtn.addEventListener('click', function() {
                        calculateEmbroideryPrice(processDiv);
                    });
                    break;
                    
                case 'washing':
                    detailsDiv.innerHTML = `
                        <div class="process-details-grid">
                            <div class="process-detail-col">
                                <div class="detail-row">
                                    <div class="detail-label">水洗类型：</div>
                                    <select class="washing-type">
                                        <option value="heavy">石墨重洗</option>
                                        <option value="spray">喷钾洗</option>
                                        <option value="light">轻洗</option>
                                        <option value="medium">中洗</option>
                                        <option value="custom">自定义</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="process-detail-col">
                                <div class="detail-row">
                                    <div class="detail-label">预设报价：</div>
                                    <div class="price-display" id="washing-price-display">$0.49</div>
                                </div>
                            </div>
                            
                            <div class="process-detail-col">
                                <div class="detail-row">
                                    <div class="detail-label">自定义报价：</div>
                                    <input type="number" class="washing-custom" step="0.01" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <button class="set-washing-price">设置水洗价格</button>
                    `;
                    
                    // 水洗类型变化事件
                    const washingTypeSelect = detailsDiv.querySelector('.washing-type');
                    washingTypeSelect.addEventListener('change', function() {
                        const priceDisplay = detailsDiv.querySelector('#washing-price-display');
                        
                        // 更新显示价格
                        const prices = {
                            'heavy': 0.49,
                            'spray': 0.67,
                            'light': 0.3,
                            'medium': 0.4,
                            'custom': 0
                        };
                        priceDisplay.textContent = '$' + prices[this.value].toFixed(2);
                    });
                    
                    // 设置水洗价格事件
                    const setWashingBtn = detailsDiv.querySelector('.set-washing-price');
                    setWashingBtn.addEventListener('click', function() {
                        const washingType = washingTypeSelect.value;
                        let price = 0;
                        const customPrice = parseFloat(detailsDiv.querySelector('.washing-custom').value) || 0;
                        
                        // 优先使用自定义价格
                        if (customPrice > 0) {
                            price = customPrice;
                        } else {
                            const prices = {
                                'heavy': 0.49,
                                'spray': 0.67,
                                'light': 0.3,
                                'medium': 0.4,
                                'custom': 0
                            };
                            price = prices[washingType] || 0;
                        }
                        
                        processDiv.querySelector('.process-total-price').textContent = '$' + price.toFixed(2);
                    });
                    break;
                    
                case 'printing':
                    detailsDiv.innerHTML = `
                        <div class="process-details-grid">
                            <div class="process-detail-col">
                                <div class="detail-row">
                                    <div class="detail-label">印刷类型：</div>
                                    <select class="printing-type">
                                        <option value="normal">普通印刷</option>
                                        <option value="sublimation">升华印刷</option>
                                        <option value="elastic">弹力胶浆印刷</option>
                                        <option value="thick">厚板印刷</option>
                                        <option value="custom">自定义</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="process-detail-col">
                                <div class="detail-row">
                                    <div class="detail-label">预设报价：</div>
                                    <div class="price-display" id="printing-price-display">$0.30</div>
                                </div>
                            </div>
                            
                            <div class="process-detail-col">
                                <div class="detail-row">
                                    <div class="detail-label">自定义报价：</div>
                                    <input type="number" class="printing-custom" step="0.01" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <button class="set-printing-price">设置印刷价格</button>
                    `;
                    
                    // 印刷类型变化事件
                    const printingTypeSelect = detailsDiv.querySelector('.printing-type');
                    printingTypeSelect.addEventListener('change', function() {
                        const priceDisplay = detailsDiv.querySelector('#printing-price-display');
                        
                        // 更新显示价格
                        const prices = {
                            'normal': 0.3,
                            'sublimation': 0.35,
                            'elastic': 0.45,
                            'thick': 0.49,
                            'custom': 0
                        };
                        priceDisplay.textContent = '$' + prices[this.value].toFixed(2);
                    });
                    
                    // 设置印刷价格事件
                    const setPrintingBtn = detailsDiv.querySelector('.set-printing-price');
                    setPrintingBtn.addEventListener('click', function() {
                        const printingType = printingTypeSelect.value;
                        let price = 0;
                        const customPrice = parseFloat(detailsDiv.querySelector('.printing-custom').value) || 0;
                        
                        // 优先使用自定义价格
                        if (customPrice > 0) {
                            price = customPrice;
                        } else {
                            const prices = {
                                'normal': 0.3,
                                'sublimation': 0.35,
                                'elastic': 0.45,
                                'thick': 0.49,
                                'custom': 0
                            };
                            price = prices[printingType] || 0;
                        }
                        
                        processDiv.querySelector('.process-total-price').textContent = '$' + price.toFixed(2);
                    });
                    break;
                    
                case 'laser':
                    detailsDiv.innerHTML = `
                        <div class="process-details-grid">
                            <div class="process-detail-col">
                                <div class="detail-row">
                                    <div class="detail-label">单个字母价格：</div>
                                    <div class="price-display">$0.15</div>
                                </div>
                                
                                <div class="detail-row">
                                    <div class="detail-label">字母数量：</div>
                                    <input type="number" class="letter-count" min="0" value="1">
                                </div>
                            </div>
                            
                            <div class="process-detail-col">
                                <div class="detail-row">
                                    <div class="detail-label">自定义报价：</div>
                                    <input type="number" class="laser-custom" step="0.01" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <button class="calculate-laser-price">计算镭射切割价格</button>
                    `;
                    
                    // 计算镭射切割价格事件
                    const laserBtn = detailsDiv.querySelector('.calculate-laser-price');
                    laserBtn.addEventListener('click', function() {
                        const letterCount = parseInt(detailsDiv.querySelector('.letter-count').value) || 0;
                        const customPrice = parseFloat(detailsDiv.querySelector('.laser-custom').value) || 0;
                        let price = 0;
                        
                        // 优先使用自定义价格
                        if (customPrice > 0) {
                            price = customPrice;
                        } else {
                            price = 0.15 * letterCount;
                        }
                        
                        processDiv.querySelector('.process-total-price').textContent = '$' + price.toFixed(2);
                    });
                    break;
                    
                case 'other':
                    detailsDiv.innerHTML = `
                        <div class="process-details-grid">
                            <div class="process-detail-col">
                                <div class="detail-row">
                                    <div class="detail-label">自定义工艺价格：</div>
                                    <input type="number" class="other-custom" step="0.01" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <button class="set-other-price">设置自定义工艺价格</button>
                    `;
                    
                    // 设置其他工艺价格事件
                    const otherBtn = detailsDiv.querySelector('.set-other-price');
                    otherBtn.addEventListener('click', function() {
                        const price = parseFloat(detailsDiv.querySelector('.other-custom').value) || 0;
                        processDiv.querySelector('.process-total-price').textContent = '$' + price.toFixed(2);
                    });
                    break;
            }
        }
        
        // 计算绣花价格
        function calculateEmbroideryPrice(processDiv) {
            const embroideryType = processDiv.querySelector('.embroidery-type').value;
            const stitches = parseInt(processDiv.querySelector('.stitches').value) || 0;
            const customPrice = parseFloat(processDiv.querySelector('.custom-embroidery-price').value) || 0;
            let price = 0;
            
            // 优先使用自定义价格
            if (customPrice > 0) {
                price = customPrice;
            } else {
                if (stitches <= 1000) {
                    if (embroideryType === 'flat') {
                        price = 0.06;
                    } else {
                        price = 0.075;
                    }
                } else if (stitches <= 8000) {
                    const base = Math.ceil(stitches / 1000);
                    if (embroideryType === 'flat') {
                        price = base * 0.06 * 1.25;
                    } else {
                        price = base * 0.075 * 1.25;
                    }
                } else {
                    const base = Math.ceil(stitches / 1000);
                    if (embroideryType === 'flat') {
                        price = base * 0.06 * 1.15;
                    } else {
                        price = base * 0.075 * 1.15;
                    }
                }
            }
            
            processDiv.querySelector('.process-total-price').textContent = '$' + price.toFixed(2);
        }
        
        // 计算工艺总价
        function calculateProcessCost() {
            let total = 0;
            const processItems = document.querySelectorAll('.process-item');
            
            processItems.forEach(item => {
                const priceText = item.querySelector('.process-total-price').textContent;
                const price = parseFloat(priceText.replace('$', '')) || 0;
                total += price;
            });
            
            document.getElementById('process-total-price').textContent = '$' + total.toFixed(2);
            document.getElementById('process-cost').textContent = '$' + total.toFixed(2);
            return total;
        }
        
        // 计算总成本
        function calculateTotalCost() {
            // 计算各部分成本
            const fabricsCost = calculateFabricsCost();
            const buttonholeCost = parseFloat(document.getElementById('buttonhole').value) * 0.01;
            const processCost = calculateProcessCost();
            
            // 辅料成本
            const accessoriesType = document.getElementById('accessories').value;
            let accessoriesCost = 0;
            if (accessoriesType === 'custom') {
                accessoriesCost = parseFloat(document.getElementById('accessories-custom').value) || 0;
            } else {
                accessoriesCost = parseFloat(accessoriesType) || 0;
            }
            
            // 吊牌成本
            const tagsType = document.getElementById('tags').value;
            let tagsCost = 0;
            if (tagsType === 'custom') {
                tagsCost = parseFloat(document.getElementById('tags-custom').value) || 0;
            } else {
                tagsCost = parseFloat(tagsType) || 0;
            }
            
            // 工时成本
            const laborType = document.getElementById('labor').value;
            let laborCost = 0;
            if (laborType === 'custom') {
                laborCost = parseFloat(document.getElementById('labor-custom').value) || 0;
            } else {
                laborCost = parseFloat(laborType) || 0;
            }
            
            // 其他杂费
            const testingCost = 0.30;
            const headCost = laborCost * 0.15;
            const commission = 0.40;
            
            // 计算总价（不含利润）
            const subtotal = fabricsCost + buttonholeCost + processCost + 
                            accessoriesCost + tagsCost + laborCost + 
                            testingCost + headCost + commission;
            
            // 利润（总价的20%）
            const profit = subtotal * 0.20;
            
            // 总成本
            const totalCost = subtotal + profit;
            
            // 更新UI
            document.getElementById('buttonhole-cost').textContent = '$' + buttonholeCost.toFixed(2);
            document.getElementById('accessories-cost').textContent = '$' + accessoriesCost.toFixed(2);
            document.getElementById('tags-cost').textContent = '$' + tagsCost.toFixed(2);
            document.getElementById('labor-cost').textContent = '$' + laborCost.toFixed(2);
            
            const miscCost = testingCost + headCost + commission + profit;
            document.getElementById('misc-cost').textContent = '$' + miscCost.toFixed(2);
            
            document.getElementById('total-price').textContent = '$' + totalCost.toFixed(2);
            
            return totalCost;
        }
    </script>
</body>
</html>